# v0.1.14 - Process Intelligence & Go Team Depth

**Release Date:** 2026-02-24
**Status:** Released

## Summary

v0.1.14 closes the gap between what sysprims knows about a process and what it exposes to
callers. The headline capability is `proc_ext`: environment variables and thread count surfaced
through the Rust library, FFI, and Go/TypeScript bindings. The release also brings CPU measurement
parity to process-tree workflows and fixes a schema contract violation in `pstat --pid --json`.

## Highlights

- **`proc_ext`**: `env` and `thread_count` on `ProcessInfo`, opt-in via `ProcessOptions`.
- **CPU parity on tree commands**: `descendants` and `kill-descendants` now support
  `--cpu-mode {lifetime|monitor}` with `--sample`.
- **Schema compliance fix**: `pstat --pid --json` now emits the required snapshot envelope with
  `schema_id`.
- **Contextual hints**: one-line stderr guidance for `--cpu-above` in lifetime mode (suppressible
  via `SYSPRIMS_NO_HINTS=1` and suppressed for `--json`).
- **CLI help depth**: `sysprims help <topic>` (`cpu-mode`, `signals`, `safety`) and expanded
  `after_help` examples on high-complexity commands.

## Changes

### `proc_ext`: Environment Variables and Thread Count

`ProcessInfo` now includes these optional fields:

```rust
pub env: Option<BTreeMap<String, String>>,
pub thread_count: Option<u32>,
```

Collection is runtime opt-in and zero-cost by default:

```rust
use sysprims_proc::{get_process_with_options, ProcessOptions};

let info = get_process_with_options(
    pid,
    ProcessOptions::default().with_env().with_threads(),
)?;
```

Go binding equivalent:

```go
info, err := sysprims.ProcessGetWithOptions(pid, &sysprims.ProcessOptions{
    IncludeEnv:     true,
    IncludeThreads: true,
})
```

Platform behavior:

| Platform |               `env`                |         `thread_count`         |
| -------- | :--------------------------------: | :----------------------------: |
| Linux    |       `/proc/[pid]/environ`        | `/proc/[pid]/status` (Threads) |
| macOS    | `sysctl(KERN_PROCARGS2)` env block | `proc_taskinfo.pti_threadnum`  |
| Windows  |   Not supported v0.1.14 (`null`)   |           Toolhelp32           |

### CPU Mode Parity on `descendants` and `kill-descendants`

Tree commands now support monitor sampling like `pstat`:

```bash
sysprims descendants 14796 --cpu-mode monitor --sample 3s --cpu-above 80 --tree
sysprims kill-descendants 14796 --cpu-mode monitor --sample 3s --cpu-above 80 --signal KILL --yes
```

This addresses a dogfooding gap where lifetime averaging missed actively spinning descendants.

### Schema Compliance: `pstat --pid --json`

`pstat --pid --json` now emits the snapshot envelope (`schema_id`, `timestamp`, `processes`).
Missing PID behavior remains non-zero exit while still returning valid JSON (`processes: []`).

### Hints and Help

- Added contextual hint for `--cpu-above` in lifetime mode.
- Added `sysprims help <topic>` for concept-level guidance.
- Added high-signal `after_help` examples for `pstat`, `descendants`, and `kill-descendants`.

### Post-Feature Release Hardening

- `make fmt`, `make fmt-check`, and `make lint` now include goneat multi-language checks while
  retaining strict Rust gates.
- Non-markdown formatting sweep applied to stabilize formatter/linter output.
- `rsfulmen` dependency updated from `0.1.2` to `0.1.4`.
- Stale `deny.toml` source allowlists removed to eliminate false-medium security findings.

## Schema Versions

| Schema                                   | v0.1.13 | v0.1.14 | Change                                                |
| ---------------------------------------- | ------- | ------- | ----------------------------------------------------- |
| `process-info.schema.json`               | v1.0.0  | v1.1.0  | Added optional `env`, `thread_count`                  |
| `process-info-sampled.schema.json`       | v1.0.0  | v1.1.0  | Sampled process schema aligned with `proc_ext` fields |
| `descendants-result.schema.json`         | v1.0.0  | v1.0.0  | No change (lifetime mode)                             |
| `descendants-result-sampled.schema.json` | -       | v1.1.0  | New sampled descendants contract                      |
| `batch-kill-result.schema.json`          | v1.0.0  | v1.0.0  | No change                                             |

## Upgrade Notes

- Changes are additive for most consumers.
- `pstat --pid --json` shape changed to the standard envelope; flat-object parsers must update.
- `proc_ext` fields default to `null`/`None` unless explicitly requested.

## Documentation Artifacts

- `docs/guides/replace-shell-outs-go.md`
- `docs/guides/process-intelligence-without-shell-outs.md`
- `docs/one-pagers/go-team-adoption-v0.1.14.md`
- `docs/one-pagers/go-team-adoption-v0.1.14.pdf`

## References

- `docs/decisions/ADR-0002-crate-structure.md`
- `docs/decisions/ADR-0004-ffi-design.md`
- `docs/decisions/ADR-0005-schema-contracts.md`
- `docs/decisions/ADR-0011-pid-validation-safety.md`
